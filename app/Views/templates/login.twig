{# app/Views/templates/login.twig #}
{% extends "base.twig" %}

{% block title %}Přihlášení - Délicious{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-5 col-lg-4">
        <div class="card card-modern">
            <div class="card-header text-center">
                <div class="icon-wrapper mx-auto">
                    <i class="bi bi-shield-lock-fill"></i>
                </div>
                <h4 class="text-white mb-0">Přihlášení do systému</h4>
            </div>
            <div class="card-body">

                {# Alert box pro chybové hlášky (zpočátku skrytý) #}
                <div id="alertBox" class="alert alert-modern alert-danger d-none" role="alert">
                    <i class="bi bi-exclamation-circle-fill me-2"></i>
                    <span id="alertMessage"></span>
                </div>

                <form id="loginForm">
                    <div class="mb-3">
                        <label for="email" class="form-label form-label-modern">
                            <i class="bi bi-envelope-fill me-1"></i> Emailová adresa
                        </label>
                        <input type="email" class="form-control form-control-modern" id="email" name="email" required
                               placeholder="vas@email.cz">
                    </div>
                    <div class="mb-4">
                        <label for="password" class="form-label form-label-modern">
                            <i class="bi bi-key-fill me-1"></i> Heslo
                        </label>
                        <input type="password" class="form-control form-control-modern" id="password" name="password" required
                               placeholder="••••••••">
                    </div>
                    <button type="submit" class="btn btn-modern btn-modern-primary w-100 py-3">
                        <i class="bi bi-box-arrow-in-right me-2"></i>
                        <span id="btnText">Přihlásit se</span>
                    </button>
                </form>

            </div>
            <div class="card-footer text-center">
                <small class="text-muted">
                    Nemáte účet? <a href="?page=register" class="fw-bold">
                        <i class="bi bi-person-plus-fill"></i> Zaregistrujte se
                    </a>
                </small>
            </div>
        </div>

        {# Demo účty #}
        <div class="card card-modern mt-3">
            <div class="card-body p-3" style="background: #f8fafc;">
                <small class="d-block mb-2" style="color: #1e293b;">
                    <i class="bi bi-info-circle-fill" style="color: #f97316;"></i> <strong>Demo účty (heslo: heslo123):</strong>
                </small>
                <small class="d-block" style="color: #64748b;">
                    <i class="bi bi-shield-fill-check"></i> admin@test.cz - Admin<br>
                    <i class="bi bi-shop"></i> dodavatel@test.cz - Dodavatel<br>
                    <i class="bi bi-person-fill"></i> zakaznik@test.cz - Zákazník
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const alertBox = document.getElementById('alertBox');
    const alertMessage = document.getElementById('alertMessage');
    const btn = this.querySelector('button[type="submit"]');
    const btnText = document.getElementById('btnText');

    // Disable button and show loading
    btn.disabled = true;
    btnText.innerHTML = 'Ověřuji<span class="spinner-modern"></span>';
    alertBox.classList.add('d-none');

    fetch('?page=login', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Success - show success message and redirect
            alertBox.classList.remove('alert-danger');
            alertBox.classList.add('alert-success');
            alertMessage.textContent = data.message;
            alertBox.classList.remove('d-none');

            setTimeout(() => {
                window.location.href = '?page=home';
            }, 500);
        } else {
            // Error - show error message
            alertMessage.textContent = data.message;
            alertBox.classList.remove('d-none');
            btn.disabled = false;
            btnText.innerHTML = '<i class="bi bi-box-arrow-in-right me-2"></i>Přihlásit se';
        }
    })
    .catch(error => {
        console.error('Chyba:', error);
        alertMessage.textContent = "Chyba komunikace se serverem. Zkontrolujte konzoli (F12).";
        alertBox.classList.remove('d-none');
        btn.disabled = false;
        btnText.innerHTML = '<i class="bi bi-box-arrow-in-right me-2"></i>Přihlásit se';
    });
});
</script>
{% endblock %}
